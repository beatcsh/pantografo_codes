import tkinter as tk
from tkinter import ttk
from tkinter import Toplevel, Button
import csv  # Importar el módulo csv

def leer_datos_csv(nombre_archivo):
    """Lee los datos desde un archivo CSV y devuelve encabezados y datos."""
    encabezados = []
    datos = []
    try:
        with open(nombre_archivo, 'r', newline='', encoding='utf-8') as archivo_csv:
            lector_csv = csv.reader(archivo_csv)
            encabezados = next(lector_csv)  # La primera línea son los encabezados
            for fila in lector_csv:
                datos.append(fila)
    except FileNotFoundError:
        print(f"Error: El archivo '{nombre_archivo}' no se encontró.")
    return encabezados, datos

def crear_tabla(parent, encabezados, datos):
    """Crea y devuelve un widget Treeview con encabezados y datos."""
    tabla = ttk.Treeview(parent, columns=encabezados, show="headings", selectmode="extended")

    for col in encabezados:
        tabla.heading(col, text=col)
        tabla.column(col, width=120, anchor=tk.CENTER)

    for fila in datos:
        tabla.insert("", tk.END, values=fila)

    # Añadir barras de desplazamiento a la tabla
    scrollbar_vertical = ttk.Scrollbar(parent, orient="vertical", command=tabla.yview)
    tabla.configure(yscrollcommand=scrollbar_vertical.set)
    scrollbar_vertical.pack(side="right", fill="y")

    scrollbar_horizontal = ttk.Scrollbar(parent, orient="horizontal", command=tabla.xview)
    tabla.configure(xscrollcommand=scrollbar_horizontal.set)
    scrollbar_horizontal.pack(side="bottom", fill="x")

    return tabla

def mostrar_tabla_seleccionable(encabezados, datos):
    """Crea una nueva ventana con la tabla y un botón para obtener la selección."""
    ventana_tabla = Toplevel(ventana_principal)
    ventana_tabla.title("Tabla Seleccionable")

    tabla = crear_tabla(ventana_tabla, encabezados, datos)
    tabla.pack(padx=10, pady=10, fill=tk.BOTH, expand=True)

    def obtener_seleccion():
        """Obtiene los IDs de las filas seleccionadas y muestra sus valores."""
        seleccionados = tabla.selection()
        if seleccionados:
            print("Filas seleccionadas:")
            for item_id in seleccionados:
                valores = tabla.item(item_id, 'values')
                print(valores)
        else:
            print("No se ha seleccionado ninguna fila.")

    boton_obtener = Button(ventana_tabla, text="Obtener Selección", command=obtener_seleccion)
    boton_obtener.pack(pady=10)

# Nombre del archivo CSV
nombre_archivo_csv = 'parametros_corte_laser.csv'

# Leer los datos del archivo CSV
encabezados_tabla, datos_tabla = leer_datos_csv(nombre_archivo_csv)

# Crear la ventana principal
ventana_principal = tk.Tk()
ventana_principal.title("Aplicación con Tabla")

# Botón para mostrar la tabla seleccionable
boton_mostrar_tabla = Button(ventana_principal, text="Mostrar Tabla y Seleccionar",
                             command=lambda: mostrar_tabla_seleccionable(encabezados_tabla, datos_tabla))
boton_mostrar_tabla.pack(pady=20)

ventana_principal.mainloop()